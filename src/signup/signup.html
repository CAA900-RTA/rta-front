<div class="content-wrapper d-flex justify-content-center align-items-center">
  
  <!-- Main Signup Form (show when not confirming) -->
  <form class="login-form" #signupForm="ngForm" (ngSubmit)="onSubmit()" *ngIf="!showConfirmation">
    <h2>Create Account</h2>

    <!-- Username -->
    <div class="form-group">
      <label for="username">Username</label>
      <input
        type="text"
        id="username"
        [(ngModel)]="formData.username"
        name="username"
        required
        #username="ngModel"
      />
      <div *ngIf="username.invalid && username.touched" class="error">
        Username is required.
      </div>
    </div>

    <!-- Password -->
    <div class="form-group">
      <label for="password">Password</label>
      <input
        type="password"
        id="password"
        [(ngModel)]="formData.password"
        name="password"
        required
        #password="ngModel"
        (input)="validatePassword(formData.password)"
        (focus)="showPasswordCriteria = true"
        (blur)="showPasswordCriteria = false"
      />

      <!-- Password Criteria - Shown only on focus -->
      <ul *ngIf="showPasswordCriteria" class="checklist">
        <li [class.valid]="passwordLength">✔ At least 8 characters</li>
        <li [class.valid]="hasUppercase">✔ At least one uppercase letter</li>
        <li [class.valid]="hasNumber">✔ At least one number</li>
        <li [class.valid]="hasSpecialChar">✔ At least one special character</li>
      </ul>

      <div *ngIf="password.invalid && password.touched && !isPasswordValid()" class="error">
        Password doesn't meet all requirements.
      </div>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email">Email Address</label>
      <input
        type="email"
        id="email"
        [(ngModel)]="formData.email"
        name="email"
        required
        #email="ngModel"
      />
      <div *ngIf="email.invalid && email.touched" class="error">
        Valid email is required.
      </div>
    </div>

    <!-- Phone -->
    <div class="form-group">
      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" [(ngModel)]="formData.phone" name="phone" />
    </div>

    <!-- Location -->
    <div class="form-group">
      <label for="location">Location (Optional)</label>
      <input type="text" id="location" [(ngModel)]="formData.location" name="location" />
    </div>
    
    <!-- Updated submit button with loading state -->
    <button type="submit" [disabled]="signupForm.invalid || !isPasswordValid() || loading">
      {{ loading ? 'Creating Account...' : 'Sign Up' }}
    </button>

    <!-- Error message display -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Login link with routerLink -->
    <div class="signup-link">
      <p>Have an account? <a routerLink="/login">Login</a></p>
    </div>
  </form>

  <!-- Confirmation Form (show when confirming) -->
  <form class="login-form" #confirmForm="ngForm" (ngSubmit)="onConfirmSignUp()" *ngIf="showConfirmation">
    <h2>Verify Your Account</h2>
    
    <div class="confirmation-text">
      We've sent a confirmation code to <strong>{{ formData.email }}</strong>. 
      Please enter the code below to verify your account.
    </div>

    <!-- Confirmation Code -->
    <div class="form-group">
      <label for="confirmationCode">Confirmation Code</label>
      <input
        type="text"
        id="confirmationCode"
        [(ngModel)]="confirmationCode"
        name="confirmationCode"
        required
        #code="ngModel"
        placeholder="Enter confirmation code"
      />
      <div *ngIf="code.invalid && code.touched" class="error">
        Confirmation code is required.
      </div>
    </div>

    <!-- Confirm button -->
    <button type="submit" [disabled]="confirmForm.invalid || loading">
      {{ loading ? 'Confirming...' : 'Confirm Account' }}
    </button>

    <!-- Back button -->
    <button type="button" (click)="goBackToSignup()" class="secondary-btn">
      Back to Sign Up
    </button>

    <!-- Error message display -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
  </form>

</div>